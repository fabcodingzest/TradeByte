<section class="text-gray-700 body-font md:ml-56 lg:ml-64 md:mx-auto md:pr-14 w-screen inline">
  <div class="container px-5 py-10 mx-auto md:px-auto">
    <div class="my-4 absolute-center">
      <h2 class="text-gray-700 lg:text-6xl text-5xl font-semibold leading-none tracking-wider px-5">
        Add Balance
      </h2>
    </div>

    <hr class="border-2 border-gray-700" />

    <div class="container py-16 mx-auto">
      <h3 class="text-2xl">Your Balance:<b> <%= user.balance%> </b></h3>
      <form
        action="/addBalance"
        method="POST"
        class="bg-white shadow-md rounded-lg px-8 pt-6 pb-8 my-6"
      >
        <div class="text-center mb-4">
          <label class="text-gray-700 text-2xl font-bold">Enter amount: Minimum $50</label>
          <input
            id="amount"
            type="number"
            min="50"
            max="50000"
            value="50"
            onchange="check(this.value)"
            class="shadow border rounded w-2/5 py-2 px-3"
            name="addAmount"
            required
          />

          <button
            type="button"
            onclick="payNow()"
            class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded mt-4"
          >
            Add Balance with Razorpay
          </button>

          <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
          <script>
            async function payNow() {
              const amount = document.getElementById("amount").value;

              const res = await fetch("/addBalance/create-order", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ addAmount: amount }),
              });

              const data = await res.json();

              const options = {
                key: "<%= process.env.RAZORPAY_KEY_ID %>",
                amount: data.amount,
                currency: "USD",
                name: "TradeByte",
                description: "Add Balance",
                order_id: data.id,
                handler: async function (response) {
                  const successRes = await fetch("/addBalance/payment-success", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                      razorpay_payment_id: response.razorpay_payment_id,
                      razorpay_order_id: response.razorpay_order_id,
                      razorpay_signature: response.razorpay_signature,
                      amount,
                    }),
                  });

                  if (successRes.ok) {
                    location.href = "/done";
                  } else {
                    location.href = "/error";
                  }
                },
                prefill: {
                  name: "Test User",
                  email: "<%= user.email %>",
                  contact: "9999999999",
                },
                theme: {
                  color: "#3399cc",
                },
              };

              const rzp = new Razorpay(options);
              rzp.open();
            }
          </script>
        </div>
      </form>

      <div class="card flex flex-wrap justify-around">
        <div class="w-auto bg-white my-4 rounded overflow-hidden shadow-lg">
          <div class="px-6 py-4">
            <div class="font-bold text-xl mb-2">VISA</div>
            <p
              class="bg-gray-100 text-gray-700 italic mb-1 flex justify-center font-bold text-2xl mt-6"
            >
              5267 3181 8797 5449
            </p>
          </div>
          <div class="px-6 pt-4 pb-2">
            <span
              class="inline-block bg-gray-200 px-4 py-1 text-sm font-semibold text-gray-700 ml-2 mr-4 mb-2"
              >MM/YY : 01/30</span
            >
            <span
              class="inline-block bg-gray-200 px-4 py-1 text-sm font-semibold text-gray-700 mb-2"
              >CVC : 123</span
            >
          </div>
        </div>
        <div class="w-auto bg-white my-4 rounded overflow-hidden shadow-lg">
          <div class="px-6 py-4">
            <div class="font-bold text-xl mb-2">VISA PREPAID</div>
            <p
              class="bg-gray-100 text-gray-700 italic mb-1 flex justify-center font-bold text-2xl mt-6"
            >
              4386 2894 0766 0153
            </p>
          </div>
          <div class="px-6 pt-4 pb-2">
            <span
              class="inline-block bg-gray-200 px-4 py-1 text-sm font-semibold text-gray-700 ml-2 mr-4 mb-2"
              >MM/YY : 12/40</span
            >
            <span
              class="inline-block bg-gray-200 px-4 py-1 text-sm font-semibold text-gray-700 mb-2"
              >CVC : 555</span
            >
          </div>
        </div>
        <div class="w-auto bg-white my-4 rounded overflow-hidden shadow-lg">
          <div class="px-6 py-4">
            <div class="font-bold text-xl mb-2">MASTERCARD</div>
            <p
              class="bg-gray-100 text-gray-700 italic mb-1 flex justify-center font-bold text-2xl mt-6"
            >
              4012 8888 8888 1881
            </p>
          </div>
          <div class="px-6 pt-4 pb-2">
            <span
              class="inline-block bg-gray-200 px-4 py-1 text-sm font-semibold text-gray-700 ml-2 mr-4 mb-2"
              >MM/YY : 11/31</span
            >
            <span
              class="inline-block bg-gray-200 px-4 py-1 text-sm font-semibold text-gray-700 mb-2"
              >CVC : 005</span
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="https://js.stripe.com/v3/"></script>
<script>
  function check(value) {
    if (parseInt(value) < 50) {
      alert("Minimum $50 is valid only");
      document.getElementById("amount").value = 50;
    }
    if (parseInt(value) > 50000) {
      alert("You can add $50,000 at a time.");
      document.getElementById("amount").value = 50000;
    }
  }
</script>
